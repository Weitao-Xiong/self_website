---
import { Image } from "astro:assets";
import MainGridLayout from "../layouts/MainGridLayout.astro";

// è·å– gallery æ–‡ä»¶å¤¹ä¸­çš„æ‰€æœ‰å›¾ç‰‡
const images = import.meta.glob<ImageMetadata>(
	"../assets/gallery/*.{jpeg,jpg,png,webp}",
	{
		import: "default",
	},
);

const imageList = await Promise.all(
	Object.entries(images).map(async ([path, resolver]) => {
		try {
			const image = await resolver();
			const filename =
				path
					.split("/")
					.pop()
					?.replace(/\.[^/.]+$/, "") || "";
			return { src: image, name: filename };
		} catch (error) {
			console.error(`Error loading image ${path}:`, error);
			return null;
		}
	}),
);
// è¿‡æ»¤æ‰åŠ è½½å¤±è´¥çš„å›¾ç‰‡
const validImageList = imageList.filter(
	(img): img is { src: ImageMetadata; name: string } => img !== null,
);
---

<MainGridLayout title="Gallery" description="Photos from Hong Kong">
  <div class="card-base px-8 py-6">
    <h1 class="text-3xl font-bold mb-2">ğŸ“¸ Gallery</h1>
    <p class="text-neutral-500 dark:text-neutral-400 mb-6">Photos from my time in Hong Kong ğŸ‡­ğŸ‡°</p>
    
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
      {validImageList.length > 0 ? (
        validImageList.map((img) => (
          <div class="overflow-hidden rounded-xl group cursor-pointer">
            <Image 
              src={img.src} 
              alt={img.name}
              class="w-full h-48 object-cover transition-transform duration-300 group-hover:scale-110"
            />
          </div>
        ))
      ) : (
        <p class="col-span-full text-center text-neutral-400 py-8">
          æš‚æ— å›¾ç‰‡ï¼Œè¯·å°†å›¾ç‰‡æ”¾å…¥ <code class="bg-neutral-100 dark:bg-neutral-800 px-2 py-1 rounded">src/assets/gallery/</code> æ–‡ä»¶å¤¹
        </p>
      )}
    </div>
  </div>
</MainGridLayout>
